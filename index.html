<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Retro OS: Ultimate Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=VT323&family=Tahoma:wght@400;700&display=swap');

        /* --- Global & Reset --- */
        * { box-sizing: border-box; }
        body {
            margin: 0; padding: 0;
            background-color: #000;
            height: 100vh; width: 100vw;
            overflow: hidden;
            font-family: 'VT323', monospace;
            user-select: none;
            -webkit-font-smoothing: none;
        }

        /* --- Monitor Frame (The Bezel) --- */
        #monitor {
            width: 100%; height: 100%;
            background: #000;
            position: relative;
            /* –≠–º—É–ª—è—Ü–∏—è —Ä–∞–º–∫–∏ —á–µ—Ä–µ–∑ inset shadow, —á—Ç–æ–±—ã –Ω–µ —Ç–µ—Ä—è—Ç—å –º–µ—Å—Ç–æ */
            box-shadow: inset 0 0 0 20px #dcdcdc, 
                        inset 0 0 0 25px #808080,
                        inset 0 0 80px rgba(0,0,0,0.8);
            padding: 25px; /* –û—Ç—Å—Ç—É–ø –≤–Ω—É—Ç—Ä–∏ —Ä–∞–º–∫–∏ */
            transition: all 0.5s;
        }

        /* --- The Screen (CRT Surface) --- */
        #screen {
            width: 100%; height: 100%;
            background-color: #000;
            position: relative;
            overflow: hidden;
            border-radius: 4px; /* –õ–µ–≥–∫–æ–µ —Å–∫—Ä—É–≥–ª–µ–Ω–∏–µ —É–≥–ª–æ–≤ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="20" style="fill:white;stroke:black;stroke-width:1px;"><path d="M0,0 L0,16 L4,12 L7,18 L9,17 L6,11 L10,11 Z" /></svg>'), auto;
        }

        /* CRT Scanlines & Flicker */
        .crt-overlay {
            position: absolute; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.5);
            animation: flicker 0.1s infinite;
        }

        /* –≠—Ñ—Ñ–µ–∫—Ç –≤—ã–∫–ª—é—á–µ–Ω–∏—è/–≤–∫–ª—é—á–µ–Ω–∏—è (–±–µ–ª–∞—è –≤—Å–ø—ã—à–∫–∞) */
        .power-effect {
            position: absolute; inset: 0;
            background: #fff;
            z-index: 10000;
            opacity: 0;
            pointer-events: none;
        }

        @keyframes turn-on {
            0% { opacity: 1; transform: scaleY(0.01) scaleX(0); background: #fff; }
            50% { opacity: 1; transform: scaleY(0.01) scaleX(1); background: #fff; }
            100% { opacity: 0; transform: scaleY(1) scaleX(1); background: transparent; }
        }

        @keyframes flicker {
            0% { opacity: 0.97; } 100% { opacity: 1; }
        }

        /* --- Layers --- */
        .layer {
            position: absolute; inset: 0;
            display: none;
        }

        /* --- Pre-Boot (Power Button) --- */
        #power-layer {
            display: flex; justify-content: center; align-items: center;
            background: #111; z-index: 50;
        }
        .power-btn {
            width: 80px; height: 80px;
            border-radius: 50%;
            background: radial-gradient(#444, #222);
            border: 2px solid #555;
            color: #0f0;
            font-size: 30px;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer;
            box-shadow: 0 0 10px #0f0;
            animation: pulse 2s infinite;
        }
        .power-btn:active { transform: scale(0.95); box-shadow: 0 0 5px #0f0; }
        @keyframes pulse { 0% { box-shadow: 0 0 5px #0f0; } 50% { box-shadow: 0 0 20px #0f0; } 100% { box-shadow: 0 0 5px #0f0; } }

        /* --- BIOS Boot --- */
        #boot-layer {
            background: #000; color: #00ff00;
            padding: 40px; font-size: 20px;
            text-shadow: 0 0 4px #00ff00;
        }
        .boot-text { margin-bottom: 5px; }

        /* --- Login Screen --- */
        #login-layer {
            background: #3a6ea5;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* --- Desktop --- */
        #desktop-layer {
            background: #008080;
            display: none;
        }

        /* --- UI Components: Windows 98 Style --- */
        .win98-window {
            position: absolute;
            background: #c0c0c0;
            border: 2px solid;
            border-color: #dfdfdf #404040 #404040 #dfdfdf;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
            min-width: 200px;
            display: flex; flex-direction: column;
        }
        
        .title-bar {
            background: linear-gradient(90deg, #000080, #1084d0);
            color: white;
            padding: 3px 5px;
            font-family: 'Tahoma', sans-serif;
            font-size: 13px;
            font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
            cursor: default;
        }

        .title-bar-controls button {
            width: 16px; height: 14px;
            font-size: 10px; line-height: 10px;
            background: #c0c0c0;
            border: 1px solid;
            border-color: #fff #404040 #404040 #fff;
            cursor: pointer; margin-left: 2px;
            font-family: sans-serif; font-weight: bold;
        }
        .title-bar-controls button:active { border-color: #404040 #fff #fff #404040; }

        .window-body {
            padding: 10px;
            font-family: 'Tahoma', sans-serif; font-size: 12px; color: #000;
        }

        .inset-field {
            background: #fff;
            border: 2px solid; border-color: #404040 #dfdfdf #dfdfdf #404040;
            padding: 3px; margin-bottom: 5px;
        }

        input { width: 100%; border: none; outline: none; font-family: 'Tahoma'; }
        
        .btn-win {
            background: #c0c0c0;
            border: 2px solid; border-color: #fff #404040 #404040 #fff;
            padding: 4px 12px;
            font-family: 'Tahoma'; font-size: 12px;
            cursor: pointer;
        }
        .btn-win:active { border-color: #404040 #fff #fff #404040; transform: translate(1px, 1px); }

        /* --- Desktop Icons --- */
        .icon {
            position: absolute;
            width: 70px;
            text-align: center;
            color: white;
            cursor: pointer;
            font-family: 'Tahoma', sans-serif; font-size: 11px;
            text-shadow: 1px 1px 0 #000;
            border: 1px solid transparent;
        }
        .icon:hover { border: 1px dotted rgba(255,255,255,0.5); background: rgba(0,0,255,0.2); }
        .icon-img {
            width: 32px; height: 32px; margin: 0 auto 5px;
            background-size: cover;
            image-rendering: pixelated;
        }

        /* --- Taskbar --- */
        .taskbar {
            position: absolute; bottom: 0; left: 0; right: 0;
            height: 28px;
            background: #c0c0c0;
            border-top: 2px solid #fff;
            display: flex; align-items: center;
            padding: 2px;
            z-index: 5000;
        }
        .start-btn {
            display: flex; align-items: center; gap: 5px;
            font-weight: bold; font-style: italic;
            padding: 2px 6px;
            height: 22px;
        }
        .tray {
            margin-left: auto;
            border: 2px solid; border-color: #404040 #fff #fff #404040;
            padding: 2px 8px;
            font-family: 'Tahoma'; font-size: 11px;
            background: #c0c0c0;
        }

        /* --- Selection Box --- */
        #selection-box {
            position: absolute;
            border: 1px dotted white;
            background: rgba(0, 0, 255, 0.2);
            display: none;
            pointer-events: none; /* –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –∫–ª–∏–∫–∏ —Å–∫–≤–æ–∑—å —Ä–∞–º–∫—É */
        }

        /* Minesweeper Grid */
        .mine-grid { display: grid; grid-template-columns: repeat(9, 20px); gap: 1px; background: #808080; border: 2px solid #808080;}
        .mine-cell { width: 20px; height: 20px; background: #c0c0c0; text-align: center; line-height: 20px; font-weight: bold; cursor: default; font-size: 14px;}
        .mine-cell.closed { border: 2px solid; border-color: #fff #808080 #808080 #fff; }
        .mine-cell.bomb { background: red; }
    </style>
</head>
<body>

    <div id="monitor">
        <div id="screen">
            <div class="crt-overlay"></div>
            <div class="power-effect" id="power-effect"></div>

            <div id="power-layer" class="layer" style="display:flex;">
                <div class="power-btn" onclick="powerOn()">‚èª</div>
            </div>

            <div id="boot-layer" class="layer">
                <div id="boot-content"></div>
            </div>

            <div id="login-layer" class="layer">
                <div class="win98-window" style="width: 350px; left: 50%; top: 50%; transform: translate(-50%, -50%);">
                    <div class="title-bar">
                        <span>Welcome to GeminiOS</span>
                    </div>
                    <div class="window-body" style="display: flex; gap: 15px;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/Key_icon_1.svg" width="48" style="filter:grayscale(100%)">
                        <div style="flex-grow: 1;">
                            <div style="margin-bottom: 5px;">Type a user name and password to log on to GeminiOS.</div>
                            <label>User name:</label>
                            <div class="inset-field"><input type="text" id="login-user" value="Administrator"></div>
                            <label>Password:</label>
                            <div class="inset-field"><input type="password" id="login-pass"></div>
                        </div>
                    </div>
                    <div class="window-body" style="text-align: right; padding-top:0;">
                        <button class="btn-win" onclick="startDesktop()">OK</button>
                        <button class="btn-win">Cancel</button>
                    </div>
                </div>
            </div>

            <div id="desktop-layer" class="layer">
                <div id="selection-box"></div>

                <div class="icon" style="top: 20px; left: 20px;" onmousedown="dragIcon(event, this)" ondblclick="openApp('minesweeper')">
                    <div class="icon-img" style="background-image: url('https://cdn-icons-png.flaticon.com/512/262/262846.png'); filter: grayscale(100%);"></div>
                    Minesweeper
                </div>
                
                <div class="icon" style="top: 110px; left: 20px;" onmousedown="dragIcon(event, this)" ondblclick="openApp('notepad')">
                    <div class="icon-img" style="background-image: url('https://cdn-icons-png.flaticon.com/512/590/590632.png'); filter: grayscale(100%);"></div>
                    Notepad
                </div>

                <div class="taskbar">
                    <button class="btn-win start-btn">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f9/Windows_logo_-_2012_%28dark_blue%29.svg/1024px-Windows_logo_-_2012_%28dark_blue%29.svg.png" width="14" style="filter:grayscale(100%) brightness(0.5);">
                        Start
                    </button>
                    <div style="width: 2px; height: 20px; border-left: 1px solid #808080; border-right: 1px solid #fff; margin: 0 5px;"></div>
                    <div id="taskbar-apps" style="display:flex; gap: 5px;"></div>
                    <div class="tray" id="clock">12:00 PM</div>
                </div>
            </div>

            <div id="windows-container"></div>
        </div>
    </div>

    <script>
        /* --- SOUND SYSTEM (Web Audio API) --- */
        const AudioCtx = window.AudioContext || window.webkitAudioContext;
        let ctx;

        const Sounds = {
            playTone: (freq, type, duration, vol = 0.1) => {
                if(!ctx) return;
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, ctx.currentTime);
                gain.gain.setValueAtTime(vol, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.start();
                osc.stop(ctx.currentTime + duration);
            },
            bootBeep: () => Sounds.playTone(800, 'square', 0.1, 0.1),
            hardDrive: () => {
                // Noise buffer simulation
                if(!ctx) return;
                const bufferSize = ctx.sampleRate * 0.5;
                const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                const data = buffer.getChannelData(0);
                for(let i=0; i<bufferSize; i++) data[i] = Math.random() * 2 - 1;
                const noise = ctx.createBufferSource();
                noise.buffer = buffer;
                const filter = ctx.createBiquadFilter();
                filter.type = 'lowpass';
                filter.frequency.value = 500;
                const gain = ctx.createGain();
                gain.gain.value = 0.05;
                noise.connect(filter);
                filter.connect(gain);
                gain.connect(ctx.destination);
                noise.start();
            },
            startup: () => {
                // Windows 95-ish chord
                setTimeout(() => Sounds.playTone(300, 'sine', 2, 0.1), 0);
                setTimeout(() => Sounds.playTone(400, 'sine', 2, 0.1), 200);
                setTimeout(() => Sounds.playTone(600, 'sine', 3, 0.1), 400);
            },
            click: () => Sounds.playTone(1200, 'triangle', 0.05, 0.05)
        };

        /* --- SYSTEM BOOT --- */
        function powerOn() {
            ctx = new AudioCtx();
            ctx.resume();
            
            document.getElementById('power-layer').style.display = 'none';
            const screen = document.getElementById('power-effect');
            screen.style.animation = 'turn-on 0.4s forwards';
            
            // –ó–∞–ø—É—Å–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
            Sounds.bootBeep();
            setTimeout(Sounds.hardDrive, 500);
            
            const bootText = document.getElementById('boot-content');
            const lines = [
                "GEMINI BIOS v2.0 Energy Star",
                "Checking NVRAM..",
                "64MB RAM SYSTEM OK",
                "Wait...",
                "Initializing Video Adapter...... OK",
                "Booting from Primary Master...",
                "Loading OS..."
            ];

            let delay = 0;
            const bootLayer = document.getElementById('boot-layer');
            bootLayer.style.display = 'block';

            lines.forEach((line, i) => {
                delay += (Math.random() * 500) + 200;
                setTimeout(() => {
                    bootText.innerHTML += `<div>${line}</div>`;
                    Sounds.playTone(2000 + (i*100), 'sawtooth', 0.02, 0.02); // typing sound
                    window.scrollTo(0, document.body.scrollHeight);
                }, delay);
            });

            setTimeout(() => {
                bootLayer.style.display = 'none';
                document.getElementById('login-layer').style.display = 'flex';
                Sounds.playTone(600, 'sine', 0.5, 0.1);
            }, delay + 1500);
        }

        function startDesktop() {
            Sounds.click();
            document.getElementById('login-layer').style.display = 'none';
            document.getElementById('desktop-layer').style.display = 'block';
            Sounds.startup();
            startClock();
        }

        /* --- CLOCK --- */
        function startClock() {
            const el = document.getElementById('clock');
            setInterval(() => {
                const d = new Date();
                el.innerText = d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }, 1000);
        }

        /* --- DESKTOP SELECTION BOX LOGIC --- */
        const desktop = document.getElementById('desktop-layer');
        const selectionBox = document.getElementById('selection-box');
        let isSelecting = false;
        let startX, startY;

        desktop.addEventListener('mousedown', (e) => {
            if (e.target !== desktop) return; // Only on empty desktop
            isSelecting = true;
            startX = e.clientX;
            startY = e.clientY;
            selectionBox.style.left = startX + 'px';
            selectionBox.style.top = startY + 'px';
            selectionBox.style.width = '0px';
            selectionBox.style.height = '0px';
            selectionBox.style.display = 'block';
        });

        document.addEventListener('mousemove', (e) => {
            if (!isSelecting) return;
            const currentX = e.clientX;
            const currentY = e.clientY;
            
            const width = Math.abs(currentX - startX);
            const height = Math.abs(currentY - startY);
            const left = Math.min(currentX, startX);
            const top = Math.min(currentY, startY);

            selectionBox.style.width = width + 'px';
            selectionBox.style.height = height + 'px';
            selectionBox.style.left = left + 'px';
            selectionBox.style.top = top + 'px';
        });

        document.addEventListener('mouseup', () => {
            isSelecting = false;
            selectionBox.style.display = 'none';
        });

        /* --- ICON DRAGGING --- */
        function dragIcon(e, el) {
            e.stopPropagation(); // Don't trigger selection box
            // Simple drag logic
            let shiftX = e.clientX - el.getBoundingClientRect().left;
            let shiftY = e.clientY - el.getBoundingClientRect().top;

            function moveAt(pageX, pageY) {
                el.style.left = pageX - shiftX + 'px';
                el.style.top = pageY - shiftY + 'px';
            }

            function onMouseMove(event) { moveAt(event.clientX, event.clientY); }
            
            document.addEventListener('mousemove', onMouseMove);
            
            el.onmouseup = function() {
                document.removeEventListener('mousemove', onMouseMove);
                el.onmouseup = null;
            };
        }

        /* --- WINDOW MANAGEMENT --- */
        let zIndexCounter = 100;
        const windowsContainer = document.getElementById('windows-container');

        function openApp(appName) {
            Sounds.click();
            zIndexCounter++;
            
            const win = document.createElement('div');
            win.className = 'win98-window';
            win.style.zIndex = zIndexCounter;
            win.style.left = (50 + (zIndexCounter*10)%100) + 'px';
            win.style.top = (50 + (zIndexCounter*10)%100) + 'px';

            // Drag functionality
            win.onmousedown = () => {
                win.style.zIndex = ++zIndexCounter;
            };

            let content = '';
            let title = '';

            if (appName === 'minesweeper') {
                title = 'Minesweeper';
                content = `<div class="inset-field" style="display:flex; justify-content:center; padding:5px; background:#c0c0c0; border:none;">
                    <button class="btn-win" style="font-size:16px;" onclick="resetMinesweeper(this)">üòä</button>
                </div>
                <div class="mine-grid" id="mine-grid-${zIndexCounter}"></div>`;
            } else if (appName === 'notepad') {
                title = 'Untitled - Notepad';
                content = `<textarea class="inset-field" style="width:300px; height:200px; resize:both;"></textarea>`;
            }

            win.innerHTML = `
                <div class="title-bar" onmousedown="dragWindow(event, this.parentNode)">
                    <span>${title}</span>
                    <div class="title-bar-controls">
                        <button onclick="this.closest('.win98-window').remove()">X</button>
                    </div>
                </div>
                <div class="window-body">
                    ${content}
                </div>
            `;

            windowsContainer.appendChild(win);

            if (appName === 'minesweeper') {
                initMinesweeper(document.getElementById(`mine-grid-${zIndexCounter}`));
            }
        }

        function dragWindow(e, win) {
            e.preventDefault();
            let shiftX = e.clientX - win.getBoundingClientRect().left;
            let shiftY = e.clientY - win.getBoundingClientRect().top;

            function moveAt(pageX, pageY) {
                win.style.left = pageX - shiftX + 'px';
                win.style.top = pageY - shiftY + 'px';
            }

            function onMouseMove(event) { moveAt(event.clientX, event.clientY); }

            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', function() {
                document.removeEventListener('mousemove', onMouseMove);
            }, {once: true});
        }

        /* --- MINESWEEPER LOGIC --- */
        function initMinesweeper(gridEl) {
            gridEl.innerHTML = '';
            let bombs = [];
            while(bombs.length < 10) {
                let r = Math.floor(Math.random() * 81);
                if(bombs.indexOf(r) === -1) bombs.push(r);
            }

            for(let i=0; i<81; i++) {
                let cell = document.createElement('div');
                cell.className = 'mine-cell closed';
                cell.dataset.id = i;
                
                cell.onclick = () => {
                    if(!cell.classList.contains('closed')) return;
                    if(bombs.includes(i)) {
                        cell.classList.add('bomb');
                        cell.innerHTML = 'üí£';
                        revealAll(gridEl, bombs);
                        alert('BOOM!');
                    } else {
                        // Count neighbors
                        let count = 0;
                        const neighbors = [-10,-9,-8,-1,1,8,9,10];
                        neighbors.forEach(n => {
                            let check = i+n;
                            if(check >=0 && check < 81 && bombs.includes(check)) count++;
                        });
                        cell.classList.remove('closed');
                        cell.style.background = '#c0c0c0';
                        if(count > 0) {
                            cell.innerText = count;
                            cell.style.color = ['blue','green','red','purple'][count-1] || 'black';
                        }
                    }
                };
                
                cell.oncontextmenu = (e) => {
                    e.preventDefault();
                    if(cell.classList.contains('closed')) {
                        cell.innerText = cell.innerText === 'üö©' ? '' : 'üö©';
                    }
                };
                
                gridEl.appendChild(cell);
            }
        }

        function revealAll(gridEl, bombs) {
            bombs.forEach(b => {
                gridEl.children[b].classList.remove('closed');
                gridEl.children[b].classList.add('bomb');
                gridEl.children[b].innerText = 'üí£';
            });
        }
        
        function resetMinesweeper(btn) {
            let grid = btn.parentNode.nextElementSibling;
            initMinesweeper(grid);
        }

    </script>
</body>
</html>